

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A tutorial introduction &mdash; The MFEM MGIS project  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Overview and main concepts" href="overview.html" />
    <link rel="prev" title="User guide" href="user_guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            The MFEM MGIS project
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/installation_guide.html">Installation guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="user_guide.html">User guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">A tutorial introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#description-of-the-test-case">Description of the test case</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#geometry-and-mesh">Geometry and mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modelling-hypothesis">Modelling hypothesis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boundary-conditions">Boundary conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mechanical-behaviour">Mechanical behaviour</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#numerical-resolution">Numerical resolution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initialization-of-the-resolution">Initialization of the resolution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#declaring-the-non-linear-problem">Declaring the non linear problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="#names-boundaries-and-materials">Names boundaries and materials</a></li>
<li class="toctree-l4"><a class="reference internal" href="#declaring-the-mechanical-behaviour">Declaring the mechanical behaviour</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialisation-of-the-temperature">Initialisation of the temperature</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boundary-condition">Boundary Condition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-linear-solver-parameters">Non linear solver parameters.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#selection-of-the-linear-solver">Selection of the linear solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="#post-processings">Post-processings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#resolution">Resolution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview and main concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviour_integrators.html">Behaviour integrators</a></li>
<li class="toctree-l2"><a class="reference internal" href="boundary_conditions.html">Boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="post_processings.html">Post-processings</a></li>
<li class="toctree-l2"><a class="reference internal" href="partial_quadrature_functions.html">Partial quadrature functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="glossary.html">Glossary Of Parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../commented_examples/commented_examples.html">Commented Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/developer_guide.html">Developer guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The MFEM MGIS project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="user_guide.html">User guide</a></li>
      <li class="breadcrumb-item active">A tutorial introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user_guide/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="a-tutorial-introduction">
<span id="mfem-mgis-tutorial"></span><h1>A tutorial introduction<a class="headerlink" href="#a-tutorial-introduction" title="Link to this heading"></a></h1>
<p>This tutorial describes how to describe in <code class="docutils literal notranslate"><span class="pre">MFEM/MGIS</span></code> a tensile test
on a notched beam made of an isotropic plastic behaviour with linear
hardening in the logarithmic space. This tutorial highlights the key
features of this project.</p>
<p>The full code is available in the <code class="docutils literal notranslate"><span class="pre">mfem-mgis-examples</span></code> repository in
<code class="docutils literal notranslate"><span class="pre">ex2</span></code> directory: <a class="reference external" href="https://github.com/latug0/mfem-mgis-examples">https://github.com/latug0/mfem-mgis-examples</a></p>
<section id="description-of-the-test-case">
<h2>Description of the test case<a class="headerlink" href="#description-of-the-test-case" title="Link to this heading"></a></h2>
<p>This tutorial considers a tensile test on a notched beam which is
modelled by plastic behaviour at finite strain:</p>
<ul class="simple">
<li><p>The geometry and the mesh is described in Section
<a class="reference internal" href="#sec-mfem-mgis-ssna303-mesh"><span class="std std-ref">Geometry and mesh</span></a>.</p></li>
<li><p>The boundary conditions are described in Section
<a class="reference internal" href="#sec-mfem-mgis-ssna303-bc"><span class="std std-ref">Boundary conditions</span></a>.</p></li>
<li><p>The mechanical behaviour is described in Section
<a class="reference internal" href="#sec-mfem-mgis-ssna303-behaviour"><span class="std std-ref">Mechanical behaviour</span></a>.</p></li>
</ul>
<p>This case is a variant of another one available on <code class="docutils literal notranslate"><span class="pre">code-aster</span></code>web
site:</p>
<p><a class="reference external" href="https://www.code-aster.org/V2/doc/v10/fr/man_v/v6/v6.01.303.pdf">https://www.code-aster.org/V2/doc/v10/fr/man_v/v6/v6.01.303.pdf</a></p>
<section id="geometry-and-mesh">
<span id="sec-mfem-mgis-ssna303-mesh"></span><h3>Geometry and mesh<a class="headerlink" href="#geometry-and-mesh" title="Link to this heading"></a></h3>
<figure class="align-center" id="fig-mfem-mgis-ssna303-mesh">
<a class="reference internal image-reference" href="../_images/mesh.svg"><img alt="Mesh used to described the notched beam" src="../_images/mesh.svg" style="width: 80.0%;" />
</a>
<figcaption>
<p><span class="caption-text">Mesh used to described the notched beam</span><a class="headerlink" href="#fig-mfem-mgis-ssna303-mesh" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>For symmetry reasons, only half of the notched beam is represented in
Figure <a class="reference internal" href="#fig-mfem-mgis-ssna303-mesh"><span class="std std-ref">Mesh used to described the notched beam</span></a>. The height (h) of the beam is
(30,mm). The half-width (w) of the beam is (5.4,mm).</p>
<p>The positions of the points (p1) (p2) and (c) are respectivly
(3,mm, 0), (5.4,mm, 4.8,mm), and (9,mm, 0).</p>
<p>This notched beam has been meshed using <a class="reference external" href="http://www-cast3m.cea.fr/">Cast3M</a> and exported in the <code class="docutils literal notranslate"><span class="pre">MED</span></code>
file format proposed and used by <a class="reference external" href="https://www.salome-platform.org/">Salomé</a> platform. This file has been
converted in the <code class="docutils literal notranslate"><span class="pre">msh</span></code> file format using
<a class="reference external" href="https://gmsh.info/">gmsh</a> tool in order to import it easily in
MFEM.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Direct support of the <code class="docutils literal notranslate"><span class="pre">MED</span></code> file format is currently under
development.</p>
</div>
</section>
<section id="modelling-hypothesis">
<h3>Modelling hypothesis<a class="headerlink" href="#modelling-hypothesis" title="Link to this heading"></a></h3>
<p>The beam is treated using the plane strain modelling hypothesis. In
finite strain, this assumes that the axial component of the deformation
gradient is set equal to (1).</p>
</section>
<section id="boundary-conditions">
<span id="sec-mfem-mgis-ssna303-bc"></span><h3>Boundary conditions<a class="headerlink" href="#boundary-conditions" title="Link to this heading"></a></h3>
<p>Dirichlet boundary conditions force the solution to attain certain a
priori prescribed values on some boundaries. The beam is fixed along the
bottom line ((y=0)) and a displacement (U_{y}) is imposed an the top of
the beam ((y=h)).</p>
<p>The symmetry axis on the left is blocked in the <code class="docutils literal notranslate"><span class="pre">x</span></code>-direction.</p>
</section>
<section id="mechanical-behaviour">
<span id="sec-mfem-mgis-ssna303-behaviour"></span><h3>Mechanical behaviour<a class="headerlink" href="#mechanical-behaviour" title="Link to this heading"></a></h3>
<section id="description">
<h4>Description<a class="headerlink" href="#description" title="Link to this heading"></a></h4>
<p>The material of the notched beam is described by a simple isotropic
elasto-plastic behaviour with isotropic hardening in the logarithmic
space <span id="id1">[<a class="reference internal" href="../index.html#id5" title="C. Miehe, N. Apel, and M. Lambrecht. Anisotropic additive plasticity in the logarithmic strain space: modular kinematic formulation and implementation based on incremental minimization principles for standard materials. Computer Methods in Applied Mechanics and Engineering, 191(47–48):5383–5425, November 2002. URL: http://www.sciencedirect.com/science/article/pii/S0045782502004383, doi:10.1016/S0045-7825(02)00438-3.">MAL02</a>]</span> and is implemented using the <a class="reference external" href="http://tfel.sourceforge.net">MFront</a>
code generator.</p>
<p>This behaviour is characterized by four parameters:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">Young</span> <span class="pre">Modulus</span></code> (<span class="math notranslate nohighlight">\(E\)</span>) is the slope of the linear part of
the stress-strain curve for a material under tension or compression
(isotropic elastic material).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Poisson</span> <span class="pre">Ratio</span></code> (<span class="math notranslate nohighlight">\(\nu\)</span>) is the coefficient to
characterize the contraction of the material perpendicular to the
direction of the force applied.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Yield</span> <span class="pre">Strength</span></code> (<span class="math notranslate nohighlight">\(\sigma_{0}\)</span>) defines the point on the
stress versus strain curve where the material initially starts to go
into plastic strain.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Strain</span> <span class="pre">Hardening</span> <span class="pre">Modulus</span></code> (H) defines the slope of the stress
versus strain curve after the point of yield of a material.</p></li>
</ul>
<p>In our example the following values are used:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left\{
    \begin{array}{lcl}
        \nu &amp; = &amp; 0.34 \\
        \epsilon &amp; = &amp; 70.10^{9} MPa \\
        H &amp; = &amp; 10.10^{9} \\
        s_0 &amp; = &amp; 300.10^{6}
    \end{array}
\right.\end{split}\]</div>
</section>
<section id="compilation-of-the-mfront-behaviour">
<h4>Compilation of the <code class="docutils literal notranslate"><span class="pre">MFront</span></code> behaviour<a class="headerlink" href="#compilation-of-the-mfront-behaviour" title="Link to this heading"></a></h4>
<p>The previous values are hard-coded in the <code class="docutils literal notranslate"><span class="pre">MFront</span></code> file. The
<code class="docutils literal notranslate"><span class="pre">MFront</span></code> implementation is stored in a source file called
<code class="docutils literal notranslate"><span class="pre">Plasticity.mfront</span></code>. This file must be compiled before the execution
of our <code class="docutils literal notranslate"><span class="pre">MFEM/MGIS</span></code> <code class="docutils literal notranslate"><span class="pre">C++</span></code> example which will be detailed in depth in
Section <a class="reference internal" href="#sec-mfem-mgis-ssna303"><span class="std std-ref">Numerical resolution</span></a>. Compilation is performed as follows:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mfront<span class="w"> </span>--obuild<span class="w"> </span>--interface<span class="o">=</span>generic<span class="w"> </span>Plasticity.mfront
Treating<span class="w"> </span>target<span class="w"> </span>:<span class="w"> </span>all
The<span class="w"> </span>following<span class="w"> </span>library<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>built<span class="w"> </span>:
-<span class="w"> </span>libBehaviour.so<span class="w"> </span>:<span class="w">  </span>Plasticity_AxisymmetricalGeneralisedPlaneStrain
<span class="w">  </span>Plasticity_Axisymmetrical<span class="w"> </span>Plasticity_PlaneStrain
<span class="w">  </span>Plasticity_GeneralisedPlaneStrain<span class="w"> </span>Plasticity_Tridimensional
</pre></div>
</div>
</section>
</section>
</section>
<section id="numerical-resolution">
<span id="sec-mfem-mgis-ssna303"></span><h2>Numerical resolution<a class="headerlink" href="#numerical-resolution" title="Link to this heading"></a></h2>
<section id="initialization-of-the-resolution">
<h3>Initialization of the resolution<a class="headerlink" href="#initialization-of-the-resolution" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">initialize</span></code> function must be called at the very beginning of the
<code class="docutils literal notranslate"><span class="pre">main</span></code> function to process the command line arguments:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">initialize</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>The ``mfem_mgis`` namespace</strong></p>
<p>All the classes and funtions of the <code class="docutils literal notranslate"><span class="pre">MFEM/MGIS</span></code> project are place
in the <code class="docutils literal notranslate"><span class="pre">mfem_mgis</span></code> namespace.</p>
</div></blockquote>
<p>This call is mostly useful in parallel and handles:</p>
<ul class="simple">
<li><p>The initialization of interprocess communications handled by the
<cite>MPI`</cite> framework.</p></li>
<li><p>The initialization of the <a class="reference external" href="https://www.mcs.anl.gov/petsc/">PETSc</a> scientific
toolkit, if supported and
requested.</p></li>
</ul>
<section id="constant-variables">
<h4>Constant variables<a class="headerlink" href="#constant-variables" title="Link to this heading"></a></h4>
<p>The code then defines some constant variables defining the path to the
mesh file, the path the the <code class="docutils literal notranslate"><span class="pre">MFront</span></code> shared library, and the name of
the behaviour:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">mesh_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ssna303.msh&quot;</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;src/libBehaviour.so&quot;</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">behaviour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Plasticity&quot;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="command-line-options">
<h4>Command line options<a class="headerlink" href="#command-line-options" title="Link to this heading"></a></h4>
<p>The numerical resolution can be parametrized using command line options
by relying on the <code class="docutils literal notranslate"><span class="pre">MFEM</span></code> facilities provided by the <code class="docutils literal notranslate"><span class="pre">OptionsParser</span></code>
class.</p>
<p>The proposed implementation allows the following options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--order</span></code> which specifies the finite element order (polynomial
degree).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--parallel</span></code> which specifices if the simulation must be run in
parallel.</p></li>
</ul>
<p>Those options options are associated with local variables which are
default initialized as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="cp">#if defined(MFEM_USE_MPI)</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="cp">#else</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>If left unchanged, those default values select:</p>
<ul class="simple">
<li><p>a parallel computation if <code class="docutils literal notranslate"><span class="pre">MFEM</span></code> was built with <code class="docutils literal notranslate"><span class="pre">MPI</span></code> support and
a sequential computation otherwise.</p></li>
<li><p>the use of linear elements.</p></li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">MFEM</span></code> was built with support of <code class="docutils literal notranslate"><span class="pre">PETSc</span></code> library, the following
options are added by the <code class="docutils literal notranslate"><span class="pre">mfem_mgis::declareDefaultOptions</span></code> function:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--use-petsc</span></code> which speficies that linear and non linear solvers of
the <code class="docutils literal notranslate"><span class="pre">PETSc</span></code> toolkit must be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--petsc-configuration-file</span></code> which specifies a configuration file
for the <code class="docutils literal notranslate"><span class="pre">PETSc</span></code> toolkit.</p></li>
</ul>
<p>In practice, an object of the class <code class="docutils literal notranslate"><span class="pre">mfem::OptionsParser</span></code> is declared.
The expected options are declared and the <code class="docutils literal notranslate"><span class="pre">Parse</span></code> method is called:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mfem</span><span class="o">::</span><span class="n">OptionsParser</span><span class="w"> </span><span class="nf">args</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="n">mfem_mgis</span><span class="o">::</span><span class="n">declareDefaultOptions</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="n">args</span><span class="p">.</span><span class="n">AddOption</span><span class="p">(</span><span class="o">&amp;</span><span class="n">parallel</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-p&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--parallel&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="s">&quot;Perform parallel computations.&quot;</span><span class="p">);</span>
<span class="n">args</span><span class="p">.</span><span class="n">AddOption</span><span class="p">(</span><span class="o">&amp;</span><span class="n">order</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--order&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="s">&quot;Finite element order (polynomial degree).&quot;</span><span class="p">);</span>
<span class="n">args</span><span class="p">.</span><span class="n">Parse</span><span class="p">();</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">args</span><span class="p">.</span><span class="n">Good</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">args</span><span class="p">.</span><span class="n">PrintUsage</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_FAILURE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="declaring-the-non-linear-problem">
<h3>Declaring the non linear problem<a class="headerlink" href="#declaring-the-non-linear-problem" title="Link to this heading"></a></h3>
<p>The non linear evolution problem is defined as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">NonLinearEvolutionProblem</span><span class="w"> </span><span class="n">problem</span><span class="p">(</span>
<span class="w">     </span><span class="p">{{</span><span class="s">&quot;MeshFileName&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mesh_file</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;FiniteElementFamily&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;H1&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;FiniteElementOrder&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;UnknownsSize&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dim</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;Hypothesis&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PlaneStrain&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;Parallel&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">parallel</span><span class="p">}});</span>
</pre></div>
</div>
<p>The constructor of the <code class="docutils literal notranslate"><span class="pre">NonLinearEvolutionProblem</span></code> class takes an
object of <code class="docutils literal notranslate"><span class="pre">Parameters</span></code> type which is able to store various kind of
data in a hierarchical structure. The valid parameters for the
construction of a non linear evolution problem are described in the
<code class="docutils literal notranslate"><span class="pre">doxygen</span></code> documentation of the <code class="docutils literal notranslate"><span class="pre">NonLinearEvolutionProblem</span></code> class.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NonLinearEvolutionProblem</span></code> class is the main class manipulated by
the end-users of the <code class="docutils literal notranslate"><span class="pre">MFEM/MGIS</span></code> library. It is meant to handle all
the aspects of the non linear resolution.</p>
<p>Thanks to the <code class="docutils literal notranslate"><span class="pre">Parameters</span></code> type, which is used at different locations
in the interface of the <code class="docutils literal notranslate"><span class="pre">NonLinearEvolutionProblem</span></code> class, the
<code class="docutils literal notranslate"><span class="pre">MFEM/MGIS</span></code> exposes a high level API (Application Programming
Interface) which hides (by default) all the details related to
parallelization and memory management. For example, the parameter
<code class="docutils literal notranslate"><span class="pre">Parallel</span></code> allows to switch from a parallel computation to a parallel
one at runtime.</p>
<blockquote>
<div><p><strong>Input files and ``python`` wrappers</strong></p>
<p>This high level API can be used to configure a resolution from an
input file or to wrap the library in <code class="docutils literal notranslate"><span class="pre">python</span></code>. Those features are
not yet implemented.</p>
</div></blockquote>
<p>Although based on the <code class="docutils literal notranslate"><span class="pre">MFEM</span></code> library, the standard end-user of the
<code class="docutils literal notranslate"><span class="pre">MFEM/MGIS</span></code> library would barely never used directly the <code class="docutils literal notranslate"><span class="pre">MFEM</span></code>
data-structures. However, the <code class="docutils literal notranslate"><span class="pre">MFEM/MGIS</span></code> library does not preclude to
directly use the <code class="docutils literal notranslate"><span class="pre">MFEM</span></code> data-structures, built-in non linear forms,
etc. This lower level API is however not described in this tutorial.</p>
</section>
<section id="names-boundaries-and-materials">
<h3>Names boundaries and materials<a class="headerlink" href="#names-boundaries-and-materials" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MFEM</span></code> distinguishes elements of the mesh (materials and boundaries)
by integers. This may seem unpractical to most users. The <code class="docutils literal notranslate"><span class="pre">MFEM/MGIS</span></code>
allows to associate names to materials and boundaries as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">setMaterialsNames</span><span class="p">({{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NotchedBeam&quot;</span><span class="p">}});</span>
<span class="n">problem</span><span class="p">.</span><span class="n">setBoundariesNames</span><span class="p">(</span>
<span class="w">    </span><span class="p">{{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;LowerBoundary&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SymmetryAxis&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UpperBoundary&quot;</span><span class="p">}});</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Automatic definition of the names of materials and boundaries</strong></p>
<p>Many mesh file formats naturally associate names to mesh elements.
This is the case for <code class="docutils literal notranslate"><span class="pre">MED</span></code> file format and the <code class="docutils literal notranslate"><span class="pre">msh</span></code> file format
generated by <code class="docutils literal notranslate"><span class="pre">gmsh</span></code>.</p>
<p>Future versions of the library may thus automatically define the
names of materials and boundaries.</p>
</div></blockquote>
</section>
<section id="declaring-the-mechanical-behaviour">
<h3>Declaring the mechanical behaviour<a class="headerlink" href="#declaring-the-mechanical-behaviour" title="Link to this heading"></a></h3>
<p>The following line associates a mechanical behaviour to the first
material:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addBehaviourIntegrator</span><span class="p">(</span><span class="s">&quot;Mechanics&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;NotchedBeam&quot;</span><span class="p">,</span>
<span class="w">                               </span><span class="s">&quot;src/libBehaviour.so&quot;</span><span class="p">,</span>
<span class="w">                               </span><span class="s">&quot;Plasticity&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The four arguments of the <code class="docutils literal notranslate"><span class="pre">addBehaviourIntegrator</span></code> are:</p>
<ul class="simple">
<li><p>The type of physical problem described. Currently two types of
physical problems are supported out of the box by the library:
<code class="docutils literal notranslate"><span class="pre">Mechanics</span></code> and <code class="docutils literal notranslate"><span class="pre">HeatTransfer</span></code>. Support for other physical
problems can be plugged in at runtime if needed.</p></li>
<li><p>The material identifier, as defined in the mesh file. This identifier
may be either an integer or a string. In the later case, the string
is interpreted as a regular expression, a feature introduced by the
<code class="docutils literal notranslate"><span class="pre">Licos</span></code> fuel performance code and which proved very pratical in
many cases <span id="id2">[<a class="reference internal" href="../index.html#id4" title="Thomas Helfer, Syriac Bejaoui, and Bruno Michel. Licos, a fuel performance code for innovative fuel elements or experimental devices design. Nuclear Engineering and Design, 294:117–136, 2015-12-01. URL: http://www.sciencedirect.com/science/article/pii/S0029549315003842 (visited on 2015-11-30), doi:10.1016/j.nucengdes.2015.07.070.">HBM01</a>]</span>.</p></li>
<li><p>The shared library containing the behaviour to be used.</p></li>
<li><p>The name of the behaviour to be used.</p></li>
</ul>
<blockquote>
<div><p><strong>Information associated with the behaviour and automatic memory
management</strong></p>
<p>Thanks to the <code class="docutils literal notranslate"><span class="pre">`MGIS</span></code>
project <span id="id3">[<a class="reference internal" href="../index.html#id7" title="Thomas Helfer, Jeremy Bleyer, Tero Frondelius, Ivan Yashchuk, Thomas Nagel, and Dmitri Naumov. The `MFrontGenericInterfaceSupport` project. Journal of Open Source Software, 5(48):2003, 2020. Publisher: The Open Journal. URL: https://doi.org/10.21105/joss.02003, doi:10.21105/joss.02003.">HBF+20</a>]</span>, all the information
related to the mechanical behaviour is retrieved, including:</p>
<ul class="simple">
<li><p>The type of behaviour (finite strain mechanical behaviour is this
case).</p></li>
<li><p>The names of material properties, parameters, state variables and
external state variables.</p></li>
<li><p>etc.</p></li>
</ul>
<p>The memory required to store the state of the materials is
automatically allocated.</p>
</div></blockquote>
</section>
<section id="initialisation-of-the-temperature">
<h3>Initialisation of the temperature<a class="headerlink" href="#initialisation-of-the-temperature" title="Link to this heading"></a></h3>
<p>The following lines define an uniform temperature on the material at the
beginning of the time step and at the end of time step:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="n">getMaterial</span><span class="p">(</span><span class="s">&quot;NotchedBeam&quot;</span><span class="p">);</span>
<span class="n">mgis</span><span class="o">::</span><span class="n">behaviour</span><span class="o">::</span><span class="n">setExternalStateVariable</span><span class="p">(</span><span class="n">m1</span><span class="p">.</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Temperature&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">293.15</span><span class="p">);</span>
<span class="n">mgis</span><span class="o">::</span><span class="n">behaviour</span><span class="o">::</span><span class="n">setExternalStateVariable</span><span class="p">(</span><span class="n">m1</span><span class="p">.</span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Temperature&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">293.15</span><span class="p">);</span>
</pre></div>
</div>
<p>Defining the temperature is required by all <code class="docutils literal notranslate"><span class="pre">MFront</span></code> behaviours.</p>
<p>The object returned a by the <code class="docutils literal notranslate"><span class="pre">getMaterial</span></code> method returns a thin
wrapper around the <code class="docutils literal notranslate"><span class="pre">MaterialDataManager</span></code> provided by the <a class="reference external" href="https://thelfer.github.io/mfem-mgis/index.html">MGIS</a> project
<span id="id4">[<a class="reference internal" href="../index.html#id7" title="Thomas Helfer, Jeremy Bleyer, Tero Frondelius, Ivan Yashchuk, Thomas Nagel, and Dmitri Naumov. The `MFrontGenericInterfaceSupport` project. Journal of Open Source Software, 5(48):2003, 2020. Publisher: The Open Journal. URL: https://doi.org/10.21105/joss.02003, doi:10.21105/joss.02003.">HBF+20</a>]</span>.</p>
<p>In the previous lines, <code class="docutils literal notranslate"><span class="pre">m1.s0</span></code> and <code class="docutils literal notranslate"><span class="pre">m1.s1</span></code> denotes respectively the
state of the material at the beginning of the time step and at the end
of the time step.</p>
</section>
<section id="boundary-condition">
<h3>Boundary Condition<a class="headerlink" href="#boundary-condition" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">NonLinearEvolutionProblem</span></code> class allows to define uniform
Dirichlet boundary conditions (imposed displacement) using the
<code class="docutils literal notranslate"><span class="pre">addUniformDirichletBoundaryCondition</span></code> method as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addUniformDirichletBoundaryCondition</span><span class="p">(</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;Boundary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;LowerBoundary&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Component&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">}});</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addUniformDirichletBoundaryCondition</span><span class="p">(</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;Boundary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SymmetryAxis&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Component&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}});</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addUniformDirichletBoundaryCondition</span><span class="p">(</span>
<span class="w">    </span><span class="p">{{</span><span class="s">&quot;Boundary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;UpperBoundary&quot;</span><span class="p">},</span>
<span class="w">     </span><span class="p">{</span><span class="s">&quot;Component&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
<span class="w">     </span><span class="p">{</span><span class="s">&quot;LoadingEvolution&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6e-3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">u</span><span class="p">;</span>
<span class="w">      </span><span class="p">}}});</span>
</pre></div>
</div>
<p>Again, the code is almost self-explanatory. If the value of the imposed
displacement is not specified (using the <code class="docutils literal notranslate"><span class="pre">LoadingEvolution</span></code>
parameter), the selected component is set to zero. The
<code class="docutils literal notranslate"><span class="pre">LoadingEvolution</span></code> parameter allows to specify the evolution of the
imposed displacement using a function of time (defined her using a
<code class="docutils literal notranslate"><span class="pre">C++</span></code> lambda expression).</p>
</section>
<section id="non-linear-solver-parameters">
<h3>Non linear solver parameters.<a class="headerlink" href="#non-linear-solver-parameters" title="Link to this heading"></a></h3>
<p>If <code class="docutils literal notranslate"><span class="pre">PETSc</span></code> is not used, the following line set the parameters of the
Newton-Raphson solver used to find the equilibrium of the whole
structure:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">usePETSc</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">problem</span><span class="p">.</span><span class="n">setSolverParameters</span><span class="p">({{</span><span class="s">&quot;VerbosityLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<span class="w">                               </span><span class="p">{</span><span class="s">&quot;RelativeTolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1e-6</span><span class="p">},</span>
<span class="w">                               </span><span class="p">{</span><span class="s">&quot;AbsoluteTolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">},</span>
<span class="w">                               </span><span class="p">{</span><span class="s">&quot;MaximumNumberOfIterations&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">}});</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Valid parameters for the <code class="docutils literal notranslate"><span class="pre">setSolverParameters</span></code> are described in the
<code class="docutils literal notranslate"><span class="pre">doxygen</span></code> documentation of the library.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">PETSc</span></code> is used (see the <code class="docutils literal notranslate"><span class="pre">--use-petcs</span></code> command line option), the
parameters associated with the choice of the non linear solver must be
provided by an external configuration file (see the
<code class="docutils literal notranslate"><span class="pre">--petsc-configuration-file</span></code> command line option).</p>
</section>
<section id="selection-of-the-linear-solver">
<h3>Selection of the linear solver<a class="headerlink" href="#selection-of-the-linear-solver" title="Link to this heading"></a></h3>
<p>If <code class="docutils literal notranslate"><span class="pre">PETSc</span></code> is not used, the linear solver can be selected using the
<code class="docutils literal notranslate"><span class="pre">setLinearSolver</span></code> method. Here we select <code class="docutils literal notranslate"><span class="pre">MUMPS</span></code>, in parallel and
<code class="docutils literal notranslate"><span class="pre">UMFPack</span></code> in sequential:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">usePETSc</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parallel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">setLinearSolver</span><span class="p">(</span><span class="s">&quot;MUMPSSolver&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{});</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">setLinearSolver</span><span class="p">(</span><span class="s">&quot;UMFPackSolver&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{});</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The second argument is an object of the <code class="docutils literal notranslate"><span class="pre">Parameters</span></code> type which can be
used to fine tune the linear solver and, in the case of iterative
solvers, optionnaly define a preconditioner. For direct solvers, no
parameters are required.</p>
</section>
<section id="post-processings">
<h3>Post-processings<a class="headerlink" href="#post-processings" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">addPostProcessing</span></code> method let the user define some built-in
postprocessings.</p>
<p>In this example, we export the displacements for visualization in
<a class="reference external" href="https://www.paraview.org/">paraview</a> and compute the resultant
force on the boundary where the displacement as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span><span class="p">.</span><span class="n">addPostProcessing</span><span class="p">(</span><span class="s">&quot;ParaviewExportResults&quot;</span><span class="p">,</span>
<span class="w">                          </span><span class="p">{{</span><span class="s">&quot;OutputFileName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ssna303-displacements&quot;</span><span class="p">}});</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addPostProcessing</span><span class="p">(</span><span class="s">&quot;ParaviewExportIntegrationPointResultsAtNodes&quot;</span><span class="p">,</span>
<span class="w">                          </span><span class="p">{{{</span><span class="s">&quot;Results&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FirstPiolaKirchhoffStress&quot;</span><span class="p">},</span>
<span class="w">                            </span><span class="p">{</span><span class="s">&quot;OutputFileName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ssna303-stress&quot;</span><span class="p">}}});</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addPostProcessing</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;ParaviewExportIntegrationPointResultsAtNodes&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">{{{</span><span class="s">&quot;Results&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;EquivalentPlasticStrain&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="s">&quot;OutputFileName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ssna303-equivalent-plastic-strain&quot;</span><span class="p">}}});</span>
<span class="n">problem</span><span class="p">.</span><span class="n">addPostProcessing</span><span class="p">(</span><span class="s">&quot;ComputeResultantForceOnBoundary&quot;</span><span class="p">,</span>
<span class="w">                          </span><span class="p">{{</span><span class="s">&quot;Boundary&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;OutputFileName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;force.txt&quot;</span><span class="p">}});</span>
</pre></div>
</div>
<p>These post-processings are called using the <code class="docutils literal notranslate"><span class="pre">executePostProcessings</span></code>
method during the runtime using the state at the end of time step. The
user may also plugged in its own post-processing.</p>
</section>
<section id="resolution">
<h3>Resolution<a class="headerlink" href="#resolution" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">NonLinearEvolutionProblem</span></code> class is meant to solve the problem on
one time step only. This allows to easily built weakly coupled non
linear resolutions (for example, thermo-mechanical resolutions where the
heat tranfer and mechanical problems are solved using a staggered
scheme) or set-up couplings with external solvers.</p>
<p>In this tutorial, a local time-substepping scheme is set up to handle
resolution failures.</p>
<p>The loading starts at time (0) and ends at time (1). This range is
divided in (50) time steps.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">nsteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">size_type</span><span class="p">{</span><span class="mi">50</span><span class="p">};</span>
<span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">real</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">nsteps</span><span class="p">;</span>
<span class="k">auto</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">real</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="k">auto</span><span class="w"> </span><span class="n">iteration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">size_type</span><span class="p">{};</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">size_type</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nsteps</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;iteration &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">iteration</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; from &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; to &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>The local time substepping scheme is simply set up as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">ct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="k">auto</span><span class="w"> </span><span class="n">dt2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dt</span><span class="p">;</span>
<span class="k">auto</span><span class="w"> </span><span class="n">nsteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">size_type</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="k">auto</span><span class="w"> </span><span class="n">nsubsteps</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">size_type</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">nsteps</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">converged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span><span class="w"> </span><span class="n">dt2</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">converged</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">--</span><span class="n">nsteps</span><span class="p">;</span>
<span class="w">    </span><span class="n">ct</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">dt2</span><span class="p">;</span>
<span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">nsteps</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="n">dt2</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="o">++</span><span class="n">nsubsteps</span><span class="p">;</span>
<span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">revert</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nsubsteps</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">mfem_mgis</span><span class="o">::</span><span class="n">raise</span><span class="p">(</span><span class="s">&quot;maximum number of substeps&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Every time a resolution is sucessful, the material state is updated
using the <code class="docutils literal notranslate"><span class="pre">update</span></code> method, the current time is incremented and the
number of the remaining substeps is decreased. The loop stops when the
remaining number of sub-steps goes to zero.</p>
<p>If the resolution failed, the local time step is divided by (2), the
number of remaining substeps is multiplied by (2) and the state of the
material is reverted to the beginning of the time step using the
<code class="docutils literal notranslate"><span class="pre">revert</span></code> method. The resolution stops if more than (10) nested reverts
are generated.</p>
<p>Once a time step has been successful, the post-processings are executed
and the time is incremented.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">problem</span><span class="p">.</span><span class="n">executePostProcessings</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">);</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">dt</span><span class="p">;</span>
<span class="w">    </span><span class="o">++</span><span class="n">iteration</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="user_guide.html" class="btn btn-neutral float-left" title="User guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="overview.html" class="btn btn-neutral float-right" title="Overview and main concepts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024, Thomas Helfer, Guillaume Latu, Raphaël Prat, Maxence Wangermez.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>