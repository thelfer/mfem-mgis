

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation guide &mdash; The MFEM MGIS project  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User guide" href="../user_guide/user_guide.html" />
    <link rel="prev" title="The MFEM/MGIS project" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            The MFEM MGIS project
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-tutorial-for-mfem-mgis-mfront-using-spack">Installation Tutorial for <code class="docutils literal notranslate"><span class="pre">MFEM-MGIS-MFront</span></code> using Spack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-1-clone-the-spack-repository">Step 1: Clone the Spack Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-set-up-spack-environment">Step 2: Set Up Spack Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-detect-available-compilers">Step 3: Detect Available Compilers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-detect-external-dependencies">Step 4: Detect External Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-install-mfem-mgis-mfront">Step 5: Install MFEM-MGIS-MFront</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-6-load-the-installed-package">Step 6: Load the Installed Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-7-build-and-install-the-project">Step 7: Build and Install the Project</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alternative-installation-method">Alternative Installation Method</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-install-required-packages">Step 1: Install Required Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-load-the-installed-packages">Step 2: Load the Installed Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-set-hypre-dir-environment-variable">Step 3: Set HYPRE_DIR Environment Variable</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-build-and-install-the-project">Step 4: Build and Install the Project</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-simple-example-based-on-mfem-mgis">Creating a Simple Example Based on <code class="docutils literal notranslate"><span class="pre">mfem-mgis</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-locate-and-copy-example-files">Step 1: Locate and Copy Example Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-set-up-and-compile-the-example">Step 2: Set Up and Compile the Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-run-the-example">Step 3: Run the Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#building-in-debug-mode">Building in Debug Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-guide-on-topaze-ccrt-of-mfem-mgis-examples">Installation Guide on Topaze/CCRT of mfem-mgis-examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-a-new-directory-and-useful-paths">Create a new directory and useful paths</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-spack-mfem-mgis-and-mfem-mgis-examples-not-required">Download Spack, mfem-mgis, and mfem-mgis-examples (not required)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-spack-mirror-on-your-machine-local">Create a Spack Mirror on Your Machine (Local)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-mfem-mgis-on-topaze">Install mfem-mgis on Topaze</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-mfem-mgis-example-on-topaze">Install MFEM-MGIS-example on Topaze</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-ccc-mprun">Using ccc_mprun</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-ccc-msub">Using ccc_msub</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/user_guide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commented_examples/commented_examples.html">Commented Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/developer_guide.html">Developer guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The MFEM MGIS project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Installation guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/installation_guide/installation_guide.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation-guide">
<h1>Installation guide<a class="headerlink" href="#installation-guide" title="Link to this heading"></a></h1>
<p>This project uses <code class="docutils literal notranslate"><span class="pre">cmake</span></code> as build system.</p>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://mfem.org/">MFEM</a></p></li>
<li><p><a class="reference external" href="https://github.com/thelfer/MFrontGenericInterfaceSupport">MGIS</a></p></li>
</ul>
<p>A simple way to install dependencies is to rely on <code class="docutils literal notranslate"><span class="pre">Spack</span></code> packaging
system. <code class="docutils literal notranslate"><span class="pre">Spack</span></code> is an open source package
manager that simplifies building, installing, customizing, and sharing
HPC software. It will allow you to install recent versions of compilers
(that handle <code class="docutils literal notranslate"><span class="pre">C++17</span></code>, for example gnu compiler suite version 8), and
to get <code class="docutils literal notranslate"><span class="pre">python</span></code>, <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and other tools that are required for this
project to be installed (see hereafter).</p>
<p>Other ways to install MFEM and MGIS are available in the file
<code class="docutils literal notranslate"><span class="pre">INSTALL_ALTERNATIVES.md</span></code>.</p>
</section>
<section id="installation-tutorial-for-mfem-mgis-mfront-using-spack">
<h2>Installation Tutorial for <code class="docutils literal notranslate"><span class="pre">MFEM-MGIS-MFront</span></code> using Spack<a class="headerlink" href="#installation-tutorial-for-mfem-mgis-mfront-using-spack" title="Link to this heading"></a></h2>
<p>This tutorial provides detailed instructions on how to install
<code class="docutils literal notranslate"><span class="pre">MFEM-MGIS-MFront</span></code> using <a class="reference external" href="https://spack.io/">Spack</a>. Follow the
steps carefully to ensure a successful installation.</p>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Ensure you have <code class="docutils literal notranslate"><span class="pre">git</span></code>, <code class="docutils literal notranslate"><span class="pre">mpi</span></code>, <code class="docutils literal notranslate"><span class="pre">hypre</span></code>, <code class="docutils literal notranslate"><span class="pre">tfel</span></code>, <code class="docutils literal notranslate"><span class="pre">mgis</span></code>, and <code class="docutils literal notranslate"><span class="pre">mfem</span></code> installed on your system with a recent c++ gnu compiler.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">spack</span></code> to install missing Prerequisites.</p></li>
</ul>
</section>
<section id="step-1-clone-the-spack-repository">
<h3>Step 1: Clone the Spack Repository<a class="headerlink" href="#step-1-clone-the-spack-repository" title="Link to this heading"></a></h3>
<p>First, clone the Spack repository from GitHub.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="o">=</span><span class="m">2</span><span class="w"> </span>--branch<span class="o">=</span>v1.0.1<span class="w"> </span>https://github.com/spack/spack.git
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Install Spack outside the source directory of <code class="docutils literal notranslate"><span class="pre">mfem-mgis</span></code> to avoid issues with CMake.</p>
</div>
</section>
<section id="step-2-set-up-spack-environment">
<h3>Step 2: Set Up Spack Environment<a class="headerlink" href="#step-2-set-up-spack-environment" title="Link to this heading"></a></h3>
<p>Set up the Spack environment by configuring the <code class="docutils literal notranslate"><span class="pre">SPACK_ROOT</span></code>
environment variable and sourcing the setup script.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">SPACK_ROOT</span><span class="o">=</span><span class="nv">$PWD</span>/spack
<span class="nb">source</span><span class="w"> </span><span class="si">${</span><span class="nv">SPACK_ROOT</span><span class="si">}</span>/share/spack/setup-env.sh
</pre></div>
</div>
</section>
<section id="step-3-detect-available-compilers">
<h3>Step 3: Detect Available Compilers<a class="headerlink" href="#step-3-detect-available-compilers" title="Link to this heading"></a></h3>
<p>Detect the available compilers on your system. Ensure to select a
version that provides C, C++, and Fortran compilers.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>compiler<span class="w"> </span>find
</pre></div>
</div>
<p>If necessary, remove unwanted compilers with the command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>compiler<span class="w"> </span>remove<span class="w"> </span>&lt;compiler_name&gt;
</pre></div>
</div>
</section>
<section id="step-4-detect-external-dependencies">
<h3>Step 4: Detect External Dependencies<a class="headerlink" href="#step-4-detect-external-dependencies" title="Link to this heading"></a></h3>
<p>Use Spack to detect already installed libraries and programs to avoid
reinstalling them.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>external<span class="w"> </span>find<span class="w"> </span>m4<span class="w"> </span>openssl<span class="w"> </span>automake<span class="w"> </span>ncurses
spack<span class="w"> </span>external<span class="w"> </span>find<span class="w"> </span>autoconf<span class="w"> </span>libtool<span class="w"> </span>xz<span class="w"> </span>gmake<span class="w"> </span>cmake
spack<span class="w"> </span>external<span class="w"> </span>find<span class="w"> </span>tar<span class="w"> </span>tcl<span class="w"> </span>perl<span class="w"> </span>curl<span class="w"> </span>zlib<span class="w"> </span>openblas
</pre></div>
</div>
</section>
<section id="step-5-install-mfem-mgis-mfront">
<h3>Step 5: Install MFEM-MGIS-MFront<a class="headerlink" href="#step-5-install-mfem-mgis-mfront" title="Link to this heading"></a></h3>
<p>Change to the <code class="docutils literal notranslate"><span class="pre">mfem-mgis</span></code> directory, add the Spack repository, and
install the package.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/rprat-pro/spack-repo-mfem-mgis.git
spack<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>spack-repo-mfem-mgis
spack<span class="w"> </span>install<span class="w"> </span>-j<span class="w"> </span><span class="m">8</span><span class="w"> </span>mfem-mgis
</pre></div>
</div>
</section>
<section id="step-6-load-the-installed-package">
<h3>Step 6: Load the Installed Package<a class="headerlink" href="#step-6-load-the-installed-package" title="Link to this heading"></a></h3>
<p>Load the installed package.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>load<span class="w"> </span>mfem-mgis
</pre></div>
</div>
</section>
<section id="step-7-build-and-install-the-project">
<h3>Step 7: Build and Install the Project<a class="headerlink" href="#step-7-build-and-install-the-project" title="Link to this heading"></a></h3>
<p>Create a build directory, configure the project with CMake, build it,
and install.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>..<span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>../install
make<span class="w"> </span>-j<span class="w"> </span><span class="m">4</span><span class="w"> </span>check
make<span class="w"> </span>install
</pre></div>
</div>
</section>
</section>
<section id="alternative-installation-method">
<h2>Alternative Installation Method<a class="headerlink" href="#alternative-installation-method" title="Link to this heading"></a></h2>
<p>If you already have <code class="docutils literal notranslate"><span class="pre">mfem</span></code>, <code class="docutils literal notranslate"><span class="pre">tfel</span></code>, and <code class="docutils literal notranslate"><span class="pre">mgis</span></code> installed via
Spack, follow these steps:</p>
<section id="step-1-install-required-packages">
<h3>Step 1: Install Required Packages<a class="headerlink" href="#step-1-install-required-packages" title="Link to this heading"></a></h3>
<p>Install the required packages using Spack.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>install<span class="w"> </span>mfem+mpi+suite-sparse
spack<span class="w"> </span>install<span class="w"> </span>tfel@5.0.1:~python~python_bindings
spack<span class="w"> </span>install<span class="w"> </span>mgis@3.0.1:+c~fortran~python
</pre></div>
</div>
</section>
<section id="step-2-load-the-installed-packages">
<h3>Step 2: Load the Installed Packages<a class="headerlink" href="#step-2-load-the-installed-packages" title="Link to this heading"></a></h3>
<p>Load the installed packages.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>load<span class="w"> </span>mfem
spack<span class="w"> </span>load<span class="w"> </span>tfel
spack<span class="w"> </span>load<span class="w"> </span>mgis
spack<span class="w"> </span>load<span class="w"> </span>hypre
</pre></div>
</div>
</section>
<section id="step-3-set-hypre-dir-environment-variable">
<h3>Step 3: Set HYPRE_DIR Environment Variable<a class="headerlink" href="#step-3-set-hypre-dir-environment-variable" title="Link to this heading"></a></h3>
<p>Set the <code class="docutils literal notranslate"><span class="pre">HYPRE_DIR</span></code> environment variable to the installation location
of <code class="docutils literal notranslate"><span class="pre">hypre</span></code>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">HYPRE_DIR</span><span class="o">=</span><span class="sb">`</span>spack<span class="w"> </span>location<span class="w"> </span>-i<span class="w"> </span>hypre<span class="sb">`</span>
</pre></div>
</div>
</section>
<section id="step-4-build-and-install-the-project">
<h3>Step 4: Build and Install the Project<a class="headerlink" href="#step-4-build-and-install-the-project" title="Link to this heading"></a></h3>
<p>Create a build directory, configure the project with CMake, and build
it.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>..
make<span class="w"> </span>-j<span class="w"> </span><span class="m">4</span><span class="w"> </span>check
</pre></div>
</div>
<p>By following these detailed instructions, you should be able to install
and configure <code class="docutils literal notranslate"><span class="pre">MFEM-MGIS-MFront</span></code> using Spack successfully.</p>
</section>
</section>
<section id="creating-a-simple-example-based-on-mfem-mgis">
<h2>Creating a Simple Example Based on <code class="docutils literal notranslate"><span class="pre">mfem-mgis</span></code><a class="headerlink" href="#creating-a-simple-example-based-on-mfem-mgis" title="Link to this heading"></a></h2>
<p>Upon executing the <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> command during the installation
process, a simple example is created in your installation directory.
This example can be found in the “install/share/mfem-mgis/examples”
directory. You can copy this example and the associated <code class="docutils literal notranslate"><span class="pre">env.sh</span></code> file
to another location. The example can be compiled using either the
<code class="docutils literal notranslate"><span class="pre">cmake</span></code> or <code class="docutils literal notranslate"><span class="pre">make</span></code> build systems.</p>
<section id="step-1-locate-and-copy-example-files">
<h3>Step 1: Locate and Copy Example Files<a class="headerlink" href="#step-1-locate-and-copy-example-files" title="Link to this heading"></a></h3>
<p>First, locate your installation directory and copy the example and
environment setup file to a new location.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">INSTALLDIR</span><span class="o">=</span>&lt;your_mfemmgis_install_directory&gt;
cp<span class="w"> </span>-r<span class="w"> </span><span class="si">${</span><span class="nv">INSTALLDIR</span><span class="si">}</span>/share/mfem-mgis/examples/ex1<span class="w"> </span>.
cp<span class="w"> </span><span class="si">${</span><span class="nv">INSTALLDIR</span><span class="si">}</span>/share/mfem-mgis/examples/env.sh<span class="w"> </span>ex1/
</pre></div>
</div>
</section>
<section id="step-2-set-up-and-compile-the-example">
<h3>Step 2: Set Up and Compile the Example<a class="headerlink" href="#step-2-set-up-and-compile-the-example" title="Link to this heading"></a></h3>
<p>Navigate to the example directory, source the environment setup file,
create a build directory, and compile the example using <code class="docutils literal notranslate"><span class="pre">cmake</span></code>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>ex1
<span class="nb">source</span><span class="w"> </span>env.sh
mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>..
make
make<span class="w"> </span>check
</pre></div>
</div>
</section>
<section id="step-3-run-the-example">
<h3>Step 3: Run the Example<a class="headerlink" href="#step-3-run-the-example" title="Link to this heading"></a></h3>
<p>After successfully building the example, you can run it using the
following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./UniaxialTensileTest
</pre></div>
</div>
</section>
</section>
<section id="building-in-debug-mode">
<h2>Building in Debug Mode<a class="headerlink" href="#building-in-debug-mode" title="Link to this heading"></a></h2>
<p>To compile the example and the <code class="docutils literal notranslate"><span class="pre">MFront</span></code> behavior in debug mode, use
the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>clean
make<span class="w"> </span><span class="nv">DEBUG</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>By following these steps, you can successfully create, build, and run a
simple example based on <code class="docutils literal notranslate"><span class="pre">mfem-mgis</span></code>. Modify the source files as needed
to develop and test your own study cases.</p>
</section>
<section id="installation-guide-on-topaze-ccrt-of-mfem-mgis-examples">
<h2>Installation Guide on Topaze/CCRT of mfem-mgis-examples<a class="headerlink" href="#installation-guide-on-topaze-ccrt-of-mfem-mgis-examples" title="Link to this heading"></a></h2>
<p>This guide provides step-by-step instructions for setting up your
environment on <code class="docutils literal notranslate"><span class="pre">Topaze/CCRT</span></code> and installing the necessary software. Follow
these steps to get started.</p>
<section id="create-a-new-directory-and-useful-paths">
<h3>Create a new directory and useful paths<a class="headerlink" href="#create-a-new-directory-and-useful-paths" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>topaze-dir<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>topaze-dir
<span class="nb">export</span><span class="w"> </span><span class="nv">MY_DIR</span><span class="o">=</span><span class="nv">$PWD</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MY_LOG</span><span class="o">=</span>YOURLOGIN
<span class="nb">export</span><span class="w"> </span><span class="nv">MY_DEST</span><span class="o">=</span>/ccc/scratch/cont002/den/YOURLOGIN/mini-test
</pre></div>
</div>
</section>
<section id="download-spack-mfem-mgis-and-mfem-mgis-examples-not-required">
<h3>Download Spack, mfem-mgis, and mfem-mgis-examples (not required)<a class="headerlink" href="#download-spack-mfem-mgis-and-mfem-mgis-examples-not-required" title="Link to this heading"></a></h3>
<p>Before proceeding, make sure to source Spack and clear your local <code class="docutils literal notranslate"><span class="pre">~/.spack</span></code> repository.
Download Spack and the git directories of <code class="docutils literal notranslate"><span class="pre">mfem-mgis</span></code> and <code class="docutils literal notranslate"><span class="pre">mfem-mgis-examples</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$MY_DIR</span>
git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="o">=</span><span class="m">2</span><span class="w"> </span>--branch<span class="o">=</span>v1.0.1<span class="w"> </span>https://github.com/spack/spack.git
rm<span class="w"> </span>-r<span class="w"> </span>~/.spack
<span class="nb">export</span><span class="w"> </span><span class="nv">SPACK_ROOT</span><span class="o">=</span><span class="nv">$PWD</span>/spack
<span class="nb">source</span><span class="w"> </span><span class="si">${</span><span class="nv">SPACK_ROOT</span><span class="si">}</span>/share/spack/setup-env.sh
<span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">SPACK_ROOT</span><span class="si">}</span>
git<span class="w"> </span>clone<span class="w"> </span>--branch<span class="o">=</span>develop<span class="w"> </span>https://github.com/spack/spack-packages.git
spack<span class="w"> </span>repo<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--destination<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>PWD<span class="k">)</span><span class="s2">/spack-packages&quot;</span><span class="w"> </span><span class="nb">builtin</span>
<span class="nb">cd</span><span class="w"> </span>..
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/thelfer/mfem-mgis.git
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/latug0/mfem-mgis-examples.git
</pre></div>
</div>
</section>
<section id="create-a-spack-mirror-on-your-machine-local">
<h3>Create a Spack Mirror on Your Machine (Local)<a class="headerlink" href="#create-a-spack-mirror-on-your-machine-local" title="Link to this heading"></a></h3>
<p>Firstly, you need to get the mfem-mgis spack repository.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/rprat-pro/spack-repo-mfem-mgis.git
spack<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span><span class="nv">$PWD</span>/spack-repo-mfem-mgis
</pre></div>
</div>
<p>Now, you will create a <code class="docutils literal notranslate"><span class="pre">spack</span></code> mirror and a boostrap directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>bootstrap<span class="w"> </span>mirror<span class="w"> </span>--binary-packages<span class="w"> </span>my_bootstrap
spack<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>re2c_mirror<span class="w"> </span>re2c@3.0
cp<span class="w"> </span>-r<span class="w"> </span>re2c_mirror/_source-cache/archive/b3/<span class="w"> </span>my_bootstrap/bootstrap_cache/_source-cache/archive
spack<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>mirror-mfem-mgis<span class="w"> </span>-D<span class="w"> </span>mfem-mgis
</pre></div>
</div>
<p>It’s possible that you will need some packages in your mirror, you can
specify them with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>mirror-mfem-mgis<span class="w"> </span>-D<span class="w"> </span>mfem-mgis<span class="w"> </span>zlib<span class="w"> </span>ca-certificates-mozilla<span class="w"> </span>zlib-ng<span class="w"> </span>util-macros<span class="w"> </span>pkgconf<span class="w"> </span>findutils<span class="w"> </span>libpciaccess<span class="w"> </span>libedit<span class="w"> </span>libxcrypt<span class="w"> </span>bison<span class="w"> </span>libevent<span class="w"> </span>numactl
</pre></div>
</div>
<p><strong>Copy Data to Topaze</strong></p>
<p>You’ll need to copy the following files to Topaze:</p>
<ul class="simple">
<li><p>spack spack</p></li>
<li><p>mfem-mgis</p></li>
<li><p>mfem-mgis-example</p></li>
</ul>
<p>Create an archive for these files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$MY_DIR</span>
tar<span class="w"> </span>cvf<span class="w"> </span>archive.tar.gz<span class="w"> </span>mfem-mgis/<span class="w"> </span>mfem-mgis-examples/<span class="w"> </span>mirror-mfem-mgis/<span class="w"> </span>spack/<span class="w"> </span>my_bootstrap/<span class="w"> </span>spack-repo-mfem-mgis/
scp<span class="w"> </span>archive.tar.gz<span class="w"> </span><span class="nv">$MY_LOG</span>@topaze.ccc.cea.fr:<span class="nv">$MY_DEST</span>/
</pre></div>
</div>
<p><strong>Load Topaze modules</strong></p>
<p>Log on <code class="docutils literal notranslate"><span class="pre">Topaze</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh<span class="w"> </span>-Y<span class="w"> </span><span class="nv">$MY_LOG</span>@topaze.ccc.cea.fr
</pre></div>
</div>
<p>Load the required modules on Topaze:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module<span class="w"> </span>load<span class="w"> </span>gnu/12.3.0
module<span class="w"> </span>load<span class="w"> </span>mpi
module<span class="w"> </span>load<span class="w"> </span>cmake/3.29.6
</pre></div>
</div>
</section>
<section id="install-mfem-mgis-on-topaze">
<h3>Install mfem-mgis on Topaze<a class="headerlink" href="#install-mfem-mgis-on-topaze" title="Link to this heading"></a></h3>
<p>Note that the installation is performed in your scratch directory, and
files are automatically removed after 3 months.</p>
<p><strong>Setup spack</strong></p>
<p>If you had a previous installation of <code class="docutils literal notranslate"><span class="pre">spack</span></code>, please clean the environment to avoid any conflicts</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>-rf<span class="w"> </span>~/.spack
</pre></div>
</div>
<p>Now extract the files and set-up the bootstrapping</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$MY_DEST</span>
tar<span class="w"> </span>xvf<span class="w"> </span>archive.tar.gz
<span class="nb">source</span><span class="w"> </span><span class="nv">$PWD</span>/spack/share/spack/setup-env.sh
spack<span class="w"> </span>repo<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--destination<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PWD</span><span class="si">}</span><span class="s2">/spack/spack-packages&quot;</span><span class="w"> </span><span class="nb">builtin</span>
spack<span class="w"> </span>bootstrap<span class="w"> </span>reset<span class="w"> </span>-y
spack<span class="w"> </span>bootstrap<span class="w"> </span>add<span class="w"> </span>--scope<span class="o">=</span>site<span class="w"> </span>--trust<span class="w"> </span>local-binaries<span class="w"> </span><span class="nv">$PWD</span>/my_bootstrap/metadata/binaries/
spack<span class="w"> </span>bootstrap<span class="w"> </span>add<span class="w"> </span>--scope<span class="o">=</span>site<span class="w"> </span>--trust<span class="w"> </span>local-sources<span class="w"> </span><span class="nv">$PWD</span>/my_bootstrap/metadata/sources/
spack<span class="w"> </span>buildcache<span class="w"> </span>update-index<span class="w"> </span><span class="nv">$PWD</span>/my_bootstrap/bootstrap_cache
spack<span class="w"> </span>bootstrap<span class="w"> </span>disable<span class="w"> </span>--scope<span class="o">=</span>site<span class="w"> </span>github-actions-v0.5
spack<span class="w"> </span>bootstrap<span class="w"> </span>disable<span class="w"> </span>--scope<span class="o">=</span>site<span class="w"> </span>github-actions-v0.6
spack<span class="w"> </span>bootstrap<span class="w"> </span>disable<span class="w"> </span>--scope<span class="o">=</span>site<span class="w"> </span>spack-install
spack<span class="w"> </span>bootstrap<span class="w"> </span>root<span class="w"> </span><span class="nv">$PWD</span>/spack/bootstrap
spack<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>spack-repo-mfem-mgis/
</pre></div>
</div>
<p>Now you can look for the compilers</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>compiler<span class="w"> </span>find
</pre></div>
</div>
<p>and remove the unnecessary ones <code class="docutils literal notranslate"><span class="pre">spack</span></code> might have found by editign the configuration file, e.g.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vim<span class="w"> </span><span class="nv">$HOME</span>/.spack/packages.yaml
</pre></div>
</div>
<p>Now everything is set to bootstrap</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>bootstrap<span class="w"> </span>now
spack<span class="w"> </span>bootstrap<span class="w"> </span>status
</pre></div>
</div>
<p>If everything goes well, you will obtain something like</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Spack<span class="w"> </span>v1.0.2<span class="w"> </span>-<span class="w"> </span>python@3.6

<span class="o">[</span>PASS<span class="o">]</span><span class="w"> </span>Core<span class="w"> </span>Functionalities

<span class="o">[</span>PASS<span class="o">]</span><span class="w"> </span>Binary<span class="w"> </span>packages
</pre></div>
</div>
<p><strong>Export SPACK Variables</strong></p>
<p>To use <code class="docutils literal notranslate"><span class="pre">MFront</span></code>, you need to export some <code class="docutils literal notranslate"><span class="pre">SPACK</span></code> variables. Please execute
the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">CC</span><span class="o">=</span><span class="s1">&#39;gcc&#39;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CXX</span><span class="o">=</span><span class="s1">&#39;g++&#39;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">FC</span><span class="o">=</span><span class="s1">&#39;mpifort&#39;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OMPI_CC</span><span class="o">=</span><span class="s1">&#39;gcc&#39;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OMPI_CXX</span><span class="o">=</span><span class="s1">&#39;g++&#39;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OMPI_FC</span><span class="o">=</span><span class="s1">&#39;gfortran&#39;</span>
</pre></div>
</div>
<p><strong>Install MFEM-MGIS</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span><span class="nv">$PWD</span>/spack-repo-mfem-mgis
spack<span class="w"> </span>mirror<span class="w"> </span>add<span class="w"> </span>MMM<span class="w"> </span><span class="nv">$PWD</span>/mirror-mfem-mgis/
</pre></div>
</div>
<p><strong>Run installation</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module<span class="w"> </span>load<span class="w"> </span>gnu/12.3.0<span class="w"> </span>mpi<span class="w"> </span>hwloc<span class="w"> </span>cmake/3.29.6
spack<span class="w"> </span>compiler<span class="w"> </span>find
spack<span class="w"> </span>external<span class="w"> </span>find<span class="w"> </span>hwloc
spack<span class="w"> </span>external<span class="w"> </span>find<span class="w"> </span>cmake
spack<span class="w"> </span>external<span class="w"> </span>find<span class="w"> </span>openssh
spack<span class="w"> </span>external<span class="w"> </span>find<span class="w"> </span>openmpi

spack<span class="w"> </span>install<span class="w"> </span>mfem-mgis%gcc@12.3.0
</pre></div>
</div>
</section>
<section id="install-mfem-mgis-example-on-topaze">
<h3>Install MFEM-MGIS-example on Topaze<a class="headerlink" href="#install-mfem-mgis-example-on-topaze" title="Link to this heading"></a></h3>
<p>Follow these steps to install mfem-mgis-example on Topaze:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>mfem-mgis-example
mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
spack<span class="w"> </span>load<span class="w"> </span>mfem-mgis
cmake<span class="w"> </span>..
make<span class="w"> </span>-j<span class="w"> </span><span class="m">10</span>
ctest
</pre></div>
</div>
<p><strong>How to run an example (ex8)</strong></p>
<p>There are two ways to run an example, such as ex8:</p>
</section>
<section id="using-ccc-mprun">
<h3>Using ccc_mprun<a class="headerlink" href="#using-ccc-mprun" title="Link to this heading"></a></h3>
<p>To run an example using ccc_mprun with 1024 processes and 1 core per process (-m access to other filesystem, -T time), execute the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ccc_mprun<span class="w"> </span>-n<span class="w"> </span><span class="m">1024</span><span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>-m<span class="w"> </span>work,store,scratch<span class="w"> </span>-T<span class="w"> </span><span class="m">84000</span><span class="w"> </span>-pmilan<span class="w"> </span>./uniaxial-elastic
</pre></div>
</div>
</section>
<section id="using-ccc-msub">
<h3>Using ccc_msub<a class="headerlink" href="#using-ccc-msub" title="Link to this heading"></a></h3>
<p>Here’s an example of a <cite>run.batch</cite> job submission file to run a VER simulation on 4096 MPI processes on the partition named milan for 84000 seconds.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#MSUB -r ver</span>
<span class="c1">#MSUB -n 4096</span>
<span class="c1">#MSUB -c 1</span>
<span class="c1">#MSUB -T 86400</span>
<span class="c1">#MSUB -o ver_4096_%I.o</span>
<span class="c1">#MSUB -e ver_4096_%I.e</span>
<span class="c1">#MSUB -q milan</span>
<span class="c1">#MSUB -m scratch,work</span>

module<span class="w"> </span>load<span class="w"> </span>gnu/13.2.0<span class="w"> </span>mpi/openmpi/4.0.5<span class="w"> </span>cmake/3.29.6
<span class="nb">export</span><span class="w"> </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span>
<span class="nb">set</span><span class="w"> </span>-x
ccc_mprun<span class="w"> </span>./ex7<span class="w"> </span>-m<span class="w"> </span>../par-mesh/mesh-4096.<span class="w"> </span>-o<span class="w"> </span><span class="m">1</span><span class="w"> </span>-r<span class="w"> </span><span class="m">2</span><span class="w"> </span>--post-processing<span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
<p>Then, to submit the job:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ccc_msub<span class="w"> </span>run.batch
</pre></div>
</div>
</section>
<section id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h3>
<p>If you encounter <code class="docutils literal notranslate"><span class="pre">Spack</span></code> errors due to missing packages, consider the following possibilities:</p>
<p>Two possibilities:</p>
<ul class="simple">
<li><p>Check if the package is already installed on Topaze by running:**</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>external<span class="w"> </span>find<span class="w"> </span>your-package
</pre></div>
</div>
<p>If the package is found, you can use it directly.</p>
<ul class="simple">
<li><p>If the package is not installed on <code class="docutils literal notranslate"><span class="pre">Topaze</span></code>, you can add its sources to your mirror directory. If you are using an SSHFS mount, you can complete your mirror by executing the following command on your host machine:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>mirror<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>your-mirror/<span class="w"> </span>-D<span class="w"> </span>your-package
</pre></div>
</div>
<p>For more questions about <code class="docutils literal notranslate"><span class="pre">spack</span></code>, see the <code class="docutils literal notranslate"><span class="pre">spack</span></code> documentation.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="The MFEM/MGIS project" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../user_guide/user_guide.html" class="btn btn-neutral float-right" title="User guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024, Thomas Helfer, Guillaume Latu, Raphaël Prat, Maxence Wangermez.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>